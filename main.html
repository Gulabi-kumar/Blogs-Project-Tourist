<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>SmartIndia Blogs</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" />


  <style>
    /* Body style */
    body {
      background: #000;
      /* black background */
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
      margin: 0;
      color: #fff;
    }

    /* Navbar container */
    .navbar {
      background: linear-gradient(90deg, #6366f1, #9333ea);
      /* blue/purple gradient */
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 30px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      position: sticky;
      top: 0;
      z-index: 100;
      border-radius: 0 0 12px 12px;
      flex-wrap: wrap;
      /* responsive for smaller screens */
    }

    /* Navbar links */
    .navbar a {
      color: #fff;
      text-decoration: none;
      margin: 5px 15px;
      font-weight: 500;
      transition: all 0.3s ease;
      padding: 8px 15px;
      border-radius: 8px;
    }

    /* Hover effect for links */
    .navbar a:hover {
      background: #fff;
      color: #6366f1;
      /* invert colors on hover */
      box-shadow: 0 4px 12px rgba(147, 51, 234, 0.5);
      transform: translateY(-3px);
    }

    /* Card style */
    .card {
      margin: 60px auto 30px;
      border-radius: 18px;
      background: #1a1a1a;
      /* dark card on black background */
      max-width: 300px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      transition: transform 0.3s;
    }

    /* Card hover effect */
    .card:hover {
      transform: translateY(-10px);
      box-shadow: 0 12px 25px rgba(147, 51, 234, 0.5);
    }

    .card:hover img {
      transform: scale(1.05);
    }

    /* Responsive for small screens */
    @media (max-width: 768px) {
      .navbar {
        flex-direction: column;
        padding: 15px;
      }

      .navbar a {
        margin: 8px 0;
      }

      .card {
        width: 90%;
        margin: 40px auto;
      }
    }

    .image-card {
      width: 250px;
      /* card width */
      height: 180px;
      /* fixed card height */
      overflow: hidden;
      border-radius: 8px;
      cursor: pointer;
    }

    .image-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      /* key part */
      display: block;
    }
  </style>



</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark px-3 fixed-top">
    <a class="navbar-brand" href="#">SmartIndia Blogs</a>
    <input id="searchInput" class="form-control ms-3" placeholder="Search blogs..." style="width: 260px" />
    <div class="ms-auto">
      <button class="btn btn-success btn-sm me-2" onclick="openAdd()">
        ➕ Add
      </button>
    </div>
  </nav>

  <div class="container mt-5 pt-4">
    <div class="row" id="blogContainer"></div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="blogModal">
    <div class="modal-dialog">
      <div class="modal-content p-3">
        <input type="hidden" id="editId" />
        <input id="title" class="form-control mb-2" placeholder="Blog Title" />
        <input id="type" class="form-control mb-2" placeholder="Type" />
        <textarea id="description" class="form-control mb-2" placeholder="Description"></textarea>
        <input id="location" class="form-control mb-2" placeholder="Location" />
        <input id="author" class="form-control mb-2" placeholder="Author" />
        <input id="datePosted" type="date" class="form-control mb-2" />
        <input id="touristPlace" class="form-control mb-2" placeholder="Tourist Place" />
        <input type="file" id="imagefile" class="form-control mb-2" accept="image/*" />

      </div>

      <button class="btn btn-primary w-100" onclick="saveBlog()">
        Save Blog
      </button>
    </div>
  </div>
  </div>

  <img src="https://drive.google.com/thumbnail?id=FILE_ID&sz=w400" ondblclick="openFullImage('FILE_ID')"
    title="Blog image preview" alt="Blog image preview" />

  <div id="imgModal" ondblclick="this.style.display='none'"
    style="display:none;position:fixed;inset:0;background:black;align-items:center;justify-content:center">
    <img id="fullImg" style="max-width:95%;max-height:95%">
  </div>


  <script>
    function openImage(fileId) {
      const imgModal = document.getElementById("imgModal");
      const fullImg = document.getElementById("fullImg");
      fullImg.src = `https://drive.google.com/thumbnail?id=${fileId}&sz=w400`;
      imgModal.style.display = "flex";
    }
    
    const BLOG_API =
      "https://script.google.com/macros/s/AKfycby7m3DE69iXYIymHXh_qOk2-4CfhG_y1xu2bjWmWq2BvwN0mtZOGCktU21sOOPzfDmS/exec";

    const blogContainer = document.getElementById("blogContainer");
    const searchInput = document.getElementById("searchInput");
    const blogModal = document.getElementById("blogModal");
    const editId = document.getElementById("editId");
    const titleInput = document.getElementById("title");
    const typeInput = document.getElementById("type");
    const descriptionInput = document.getElementById("description");
    const locationInput = document.getElementById("location");
    const authorInput = document.getElementById("author");
    const datePostedInput = document.getElementById("datePosted");
    const touristPlaceInput = document.getElementById("touristPlace");
    const imageFileInput = document.getElementById("imagefile");

    // Load blogs
    async function loadBlogs() {
      try {
        const res = await fetch(BLOG_API + "?action=blogs");
        const blogs = await res.json();
        localStorage.setItem("blogs", JSON.stringify(blogs));
        renderBlogs(blogs);
      } catch (err) {
        console.error("Error loading blogs:", err);
      }
    }

    // Render blogs

    function renderBlogs(blogs) {
      blogContainer.innerHTML = "";

      blogs.forEach((blog) => {
        const url = blog.imageUrl;
        const fileId = url.split("id=")[1];
        // console.log("blog.id:",   fileId);
        blogContainer.innerHTML += `
            <div class="col-md-3 mb-4">
              <div class="card h-100">
                <div class="image-card">
                <img
                  src="https://drive.google.com/thumbnail?id=${fileId}&sz=w400"
                  alt="Preview"
                  ondblclick="openImage('${fileId}')"
                />
               </div>

                <div class="card-body">
                  <h5>${blog.blogTitle}</h5>
                  <span class="badge bg-primary">${blog.blogType}</span>
                  <p>${blog.blogDescription}</p>
                  <p><b>Author:</b> ${blog.author}</p>
                  <p><b>Date:</b> ${blog.datePosted.split("T")[0]}</p>
                  <p><b>Location:</b> ${blog.location}</p>
                  <p><b>Tourist Place:</b> ${blog.touristPlace}</p>
                  <button class="btn btn-warning btn-sm w-100" 
                          onclick='editBlog(${JSON.stringify(blog)})'>✏️ Edit</button>
                </div>
              </div>
            </div>
          `;

      });
    }


    // Search
    searchInput.addEventListener("input", () => {
      const txt = searchInput.value.toLowerCase();
      const blogs = JSON.parse(localStorage.getItem("blogs")) || [];
      renderBlogs(
        blogs.filter((b) => b.blogTitle.toLowerCase().includes(txt))
      );
    });

    // Open add modal
    function openAdd() {
      editId.value = "";
      blogModal
        .querySelectorAll("input,textarea")
        .forEach((e) => (e.value = ""));
      new bootstrap.Modal(blogModal).show();
    }

    // Edit blog
    function editBlog(b) {
      editId.value = b.id;
      titleInput.value = b.blogTitle;
      typeInput.value = b.blogType;
      descriptionInput.value = b.blogDescription;
      locationInput.value = b.location;
      authorInput.value = b.author;
      datePostedInput.value = b.datePosted.split("T")[0];
      touristPlaceInput.value = b.touristPlace;
      new bootstrap.Modal(blogModal).show();
    }

    // File to Base64
    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(",")[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // Save blog
    async function saveBlog() {
      const fd = new FormData();
      fd.append("action", "saveBlog");
      fd.append("id", editId.value || Date.now());
      fd.append("blogTitle", titleInput.value || "Untitled");
      fd.append("blogType", typeInput.value || "Unknown");
      fd.append("blogDescription", descriptionInput.value || "");
      fd.append("location", locationInput.value || "");
      fd.append("author", authorInput.value || "Anonymous");
      fd.append(
        "datePosted",
        datePostedInput.value || new Date().toISOString()
      );
      fd.append("touristPlace", touristPlaceInput.value || "");

      if (imageFileInput.files.length > 0) {
        const file = imageFileInput.files[0];
        const base64 = await toBase64(file);
        fd.append("imageBase64", base64);
        fd.append("imageName", file.name);
        fd.append("imageType", file.type);
      }

      try {
        const res = await fetch(BLOG_API, { method: "POST", body: fd });
        const result = await res.json();
        if (result.success) {
          loadBlogs();
          new bootstrap.Modal(blogModal).hide();
        } else alert("Failed: " + result.message);
      } catch (err) {
        alert("Error: " + err.message);
      }
    }

    // Initial load
    loadBlogs();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>SmartIndia Blogs ‚ú®</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    body {
      background-color: rgb(22, 19, 34);
      font-family: "Segoe UI", system-ui, sans-serif;
      min-height: 100vh;
      color: #e5e7eb;
    }

    .navbar {
      background-color: rgb(14, 156, 14);
    }


    /* MODAL BACKDROP */
    .modal-backdrop.show {
      opacity: 0.85;
    }

    /* MODAL CONTENT */
    .modal-content {
      background: linear-gradient(135deg, #1e1b2e, #2a2540);
      color: #e5e7eb;
      border-radius: 16px;
      border: none;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7);
    }

    /* MODAL HEADER */
    .modal-header {
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding: 16px 20px;
    }

    .modal-title {
      font-weight: 600;
      color: #f9fafb;
    }

    /* CLOSE BUTTON */
    .modal-header .btn-close {
      filter: invert(1);
      opacity: 0.8;
    }

    .modal-header .btn-close:hover {
      opacity: 1;
    }

    /* MODAL BODY */
    .modal-body {
      padding: 20px;
    }

    /* INPUTS & TEXTAREA */
    .modal-body input,
    .modal-body textarea {
      background-color: #18152a;
      border: 1px solid rgba(255, 255, 255, 0.12);
      color: #f9fafb;
      border-radius: 10px;
      padding: 10px 14px;
      transition: all 0.2s ease;
    }

    .modal-body input::placeholder,
    .modal-body textarea::placeholder {
      color: #9ca3af;
    }

    /* INPUT FOCUS */
    .modal-body input:focus,
    .modal-body textarea:focus {
      background-color: #1f1b35;
      border-color: #22c55e;
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.25);
      color: #fff;
    }

    /* TEXTAREA HEIGHT */
    .modal-body textarea {
      min-height: 100px;
      resize: vertical;
    }

    /* FILE INPUT */
    .modal-body input[type="file"] {
      padding: 6px;
      background-color: #18152a;
      color: #9ca3af;
    }

    /* MODAL FOOTER */
    .modal-footer {
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding: 14px 20px;
    }

    /* SAVE BUTTON */
    .modal-footer .btn-success {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      border: none;
      border-radius: 10px;
      padding: 8px 22px;
      font-weight: 600;
      transition: all 0.25s ease;
    }

    .modal-footer .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(34, 197, 94, 0.4);
    }

    .card {
      margin: 60px auto 30px;
      border-radius: 18px;
      background: #1a1a1a;
      /* dark card on black background */
      max-width: 300px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
      transition: transform 0.3s, box-shadow 0.3s;
    }

    /* Card hover effect */
    .card:hover {
      transform: translateY(-10px);
      box-shadow: 0 12px 25px rgba(147, 51, 234, 0.5);
    }

    .card:hover img {
      transform: scale(1.05);
    }

    .image-card {
      width: 300px;
      height: 200px;
      overflow: hidden;
      border-radius: 8px;
      cursor: pointer;
    }

    .image-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
  </style>
</head>

<body>

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-dark px-3 fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">SmartIndia Blogs</a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarContent">
        <input id="searchInput" class="form-control ms-lg-3 my-2 my-lg-0" placeholder="Search blogs..."
          style="max-width:260px" />

        <span id="userNameNav" class="text-white me-3 fw-bold "></span>

        <div class="ms-auto mt-3 mt-lg-0">
          <a id="loginNav" href="login.html" class="btn btn-outline-light btn-sm me-2">Login</a>
          <a id="signupNav" href="signup.html" class="btn btn-outline-light btn-sm me-2">Signup</a>
          <button id="addBtn" class="btn btn-success btn-sm me-2" onclick="openAdd()">‚ûï Add</button>
          <button id="logoutBtn" class="btn btn-danger btn-sm" onclick="logout()">üö™ Logout</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- BLOGS -->
  <div class="container mt-5 pt-4">
    <div id="blogContainer" class="row"></div>
  </div>

  <!-- ADD / EDIT MODAL (REQUIRED) -->
  <div class="modal fade" id="blogModal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add / Edit Blog</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="editId">
          <input id="title" class="form-control mb-2" placeholder="Title">
          <input id="type" class="form-control mb-2" placeholder="Type">
          <textarea id="description" class="form-control mb-2" placeholder="Description"></textarea>
          <input id="location" class="form-control mb-2" placeholder="Location">
          <input id="author" class="form-control mb-2" placeholder="Author">
          <input id="datePosted" type="date" class="form-control mb-2">
          <input id="touristPlace" class="form-control mb-2" placeholder="Tourist Place">
          <input id="imagefile" type="file" class="form-control">
        </div>
        <div class="modal-footer">
          <button class="btn btn-success" onclick="saveBlog()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- EXTRA IMAGE MODAL  -->

  <img src="https://drive.google.com/thumbnail?id=FILE_ID&sz=w400" ondblclick="openFullImage('FILE_ID')"
    title="Blog image preview" id="ImagePreview" />

  <div id="imgModal" ondblclick="this.style.display='none'"
    style="display:none;position:fixed;inset:0;background:black;align-items:center;justify-content:center">
    <img id="fullImg" style="max-width:95%;max-height:95%">
  </div>

  <div id="footer"></div>

  <script>
    function openImage(fileId) {
      const imgModal = document.getElementById("imgModal");
      const fullImg = document.getElementById("fullImg");
      // console.log("Opening image with fileId:", fileId);
      fullImg.src = `https://drive.google.com/thumbnail?id=${fileId}&sz=w400`;
      imgModal.style.display = "flex";
    }
  </script>


  <script>

    const BLOG_API = "https://script.google.com/macros/s/AKfycby7m3DE69iXYIymHXh_qOk2-4CfhG_y1xu2bjWmWq2BvwN0mtZOGCktU21sOOPzfDmS/exec";

    const user = JSON.parse(localStorage.getItem("user"));

    const addBtn = document.getElementById("addBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const loginNav = document.getElementById("loginNav");
    const signupNav = document.getElementById("signupNav");
    const userNameNav = document.getElementById("userNameNav");
    const blogContainer = document.getElementById("blogContainer");
    const searchInput = document.getElementById("searchInput");

    const blogModal = document.getElementById("blogModal");
    const editId = document.getElementById("editId");
    const titleInput = document.getElementById("title");
    const typeInput = document.getElementById("type");
    const descriptionInput = document.getElementById("description");
    const locationInput = document.getElementById("location");
    const authorInput = document.getElementById("author");
    const datePostedInput = document.getElementById("datePosted");
    const touristPlaceInput = document.getElementById("touristPlace");
    const imageFileInput = document.getElementById("imagefile");

    /* LOGIN CHECK */
    if (!user) {
      addBtn.style.display = "none";
      logoutBtn.style.display = "none";
      userNameNav.style.display = "none";
    } else {
      loginNav.style.display = "none";
      signupNav.style.display = "none";
      userNameNav.innerText = "üë§ " + (user.name || "User");
    }

    function logout() {
      localStorage.removeItem("user");
      window.location.href = "login.html";
    }

    async function loadBlogs() {
      const res = await fetch(BLOG_API + "?action=blogs");
      const blogs = await res.json();
      localStorage.setItem("blogs", JSON.stringify(blogs));
      renderBlogs(blogs);
    }

    function renderBlogs(blogs) {
      blogContainer.innerHTML = "";

      blogs.forEach(blog => {
        const url = blog.imageUrl || "";
        const fileId = url.includes("id=") ? url.split("id=")[1] : "";

        blogContainer.innerHTML += `
          <div class="col-md-3 mb-4">
            <div class="card h-100">
              <div class="image-card">
                <img
                  src="https://drive.google.com/thumbnail?id=${fileId}&sz=w400"
                  alt="Preview"
                  ondblclick="openImage('${fileId}')"
                />
                />
               </div>
              <div class="card-body">
                  <h5>${blog.blogTitle}</h5>
                  <span class="badge bg-primary">${blog.blogType}</span>
                  <p>${blog.blogDescription}</p>
                  <p><b>Author:</b> ${blog.author}</p>
                  <p><b>Date:</b> ${blog.datePosted.split("T")[0]}</p>
                  <p><b>Location:</b> ${blog.location}</p>
                  <p><b>Tourist Place:</b> ${blog.touristPlace}</p>

                ${user ? `
                <button class="btn btn-warning btn-sm w-100 mt-4"
                  onclick='editBlog(${JSON.stringify(blog)})'>‚úèÔ∏è Edit</button>
                ` : ``}
                <a href="blog-details.html?id=${blog.id}&"class="btn btn-info btn-sm w-100 mt-2">More</a>
              </div>
            </div>
          </div>`;
      });
    }

    function openAdd() {
      editId.value = "";
      blogModal.querySelectorAll("input,textarea").forEach(e => e.value = "");
      new bootstrap.Modal(blogModal).show();
    }

    function editBlog(b) {
      editId.value = b.id;
      titleInput.value = b.blogTitle;
      typeInput.value = b.blogType;
      descriptionInput.value = b.blogDescription;
      locationInput.value = b.location;
      authorInput.value = b.author;
      datePostedInput.value = b.datePosted.split("T")[0];
      touristPlaceInput.value = b.touristPlace;
      new bootstrap.Modal(blogModal).show();
    }

    function toBase64(file) {
      return new Promise((resolve) => {
        const r = new FileReader();
        r.onload = () => resolve(r.result.split(",")[1]);
        r.readAsDataURL(file);
      });
    }

    async function saveBlog() {
      const fd = new FormData();
      fd.append("action", "saveBlog");
      fd.append("id", editId.value || Date.now());
      fd.append("blogTitle", titleInput.value);
      fd.append("blogType", typeInput.value);
      fd.append("blogDescription", descriptionInput.value);
      fd.append("location", locationInput.value);
      fd.append("author", authorInput.value);
      fd.append("datePosted", datePostedInput.value || new Date().toISOString());
      fd.append("touristPlace", touristPlaceInput.value);

      if (imageFileInput.files.length) {
        const f = imageFileInput.files[0];
        fd.append("imageBase64", await toBase64(f));
        fd.append("imageName", f.name);
        fd.append("imageType", f.type);
      }

      const res = await fetch(BLOG_API, { method: "POST", body: fd });
      const result = await res.json();
      if (result.success) {
        loadBlogs();
        bootstrap.Modal.getInstance(blogModal).hide();
      } else alert("Save failed");
    }

    loadBlogs();
  </script>
  <script>
    fetch("footer.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("footer").innerHTML = html;
      })
      .catch(err => console.error("Footer load error:", err));
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
